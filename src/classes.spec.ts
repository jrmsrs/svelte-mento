import { describe, it, expect } from 'vitest'
import { Album, Artist } from './classes'

const sampleAlbumQuery = `
{"album":{"artist":"Madvillain","mbid":"264702af-dd10-46b5-83ef-7419552de193","tags":{"tag":[{"url":"https://www.last.fm/tag/hip-hop","name":"hip-hop"},{"url":"https://www.last.fm/tag/hip+hop","name":"hip hop"},{"url":"https://www.last.fm/tag/underground+hip-hop","name":"underground hip-hop"},{"url":"https://www.last.fm/tag/rap","name":"rap"},{"url":"https://www.last.fm/tag/madlib","name":"madlib"}]},"playcount":"56460650","image":[{"size":"small","#text":"https://lastfm.freetls.fastly.net/i/u/34s/893fce336634c600b2bab31de7bbc9bd.jpg"},{"size":"medium","#text":"https://lastfm.freetls.fastly.net/i/u/64s/893fce336634c600b2bab31de7bbc9bd.jpg"},{"size":"large","#text":"https://lastfm.freetls.fastly.net/i/u/174s/893fce336634c600b2bab31de7bbc9bd.jpg"},{"size":"extralarge","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/893fce336634c600b2bab31de7bbc9bd.jpg"},{"size":"mega","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/893fce336634c600b2bab31de7bbc9bd.jpg"},{"size":"","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/893fce336634c600b2bab31de7bbc9bd.jpg"}],"tracks":{"track":[{"streamable":{"fulltrack":"0","#text":"0"},"duration":115,"url":"https://www.last.fm/music/Madvillain/Madvillainy/The+Illest+Villains","name":"The Illest Villains","@attr":{"rank":1},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":118,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Accordion","name":"Accordion","@attr":{"rank":2},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Meat+Grinder","name":"Meat Grinder","@attr":{"rank":3},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Bistro","name":"Bistro","@attr":{"rank":4},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":150,"url":"https://www.last.fm/music/Madvillain+feat.+Medaphoar/Madvillainy/Raid","name":"Raid","@attr":{"rank":5},"artist":{"url":"https://www.last.fm/music/Madvillain+feat.+Medaphoar","name":"Madvillain feat. Medaphoar","mbid":""}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":242,"url":"https://www.last.fm/music/Madvillain/Madvillainy/America%27s+Most+Blunted","name":"America's Most Blunted","@attr":{"rank":6},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":81,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Sickfit","name":"Sickfit","@attr":{"rank":7},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Rainbows","name":"Rainbows","@attr":{"rank":8},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Curls","name":"Curls","@attr":{"rank":9},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Money+Folder","name":"Money Folder","@attr":{"rank":10},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":156,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Shadows+of+Tomorrow","name":"Shadows of Tomorrow","@attr":{"rank":11},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":125,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Operation+Lifesaver+a.k.a.+Mint+Test","name":"Operation Lifesaver a.k.a. Mint Test","@attr":{"rank":12},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Figaro","name":"Figaro","@attr":{"rank":13},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":81,"url":"https://www.last.fm/music/Madvillain+feat.+Wildchild/Madvillainy/Hardcore+Hustle","name":"Hardcore Hustle","@attr":{"rank":14},"artist":{"url":"https://www.last.fm/music/Madvillain+feat.+Wildchild","name":"Madvillain feat. Wildchild","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Strange+Ways","name":"Strange Ways","@attr":{"rank":15},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":115,"url":"https://www.last.fm/music/Madvillain+Feat.+Viktor+Vaughn/Madvillainy/Fancy+Clown","name":"Fancy Clown","@attr":{"rank":16},"artist":{"url":"https://www.last.fm/music/Madvillain+Feat.+Viktor+Vaughn","name":"Madvillain Feat. Viktor Vaughn","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":117,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Eye+%2F+Supervillain+Theme","name":"Eye / Supervillain Theme","@attr":{"rank":17},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":131,"url":"https://www.last.fm/music/Madvillain/Madvillainy/All+Caps","name":"All Caps","@attr":{"rank":18},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":null,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Great+Day","name":"Great Day","@attr":{"rank":19},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":238,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Rhinestone+Cowboy","name":"Rhinestone Cowboy","@attr":{"rank":20},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}},{"streamable":{"fulltrack":"0","#text":"0"},"duration":107,"url":"https://www.last.fm/music/Madvillain/Madvillainy/Money+Folder+(remix)","name":"Money Folder (remix)","@attr":{"rank":21},"artist":{"url":"https://www.last.fm/music/Madvillain","name":"Madvillain","mbid":"4e024037-14b7-4aea-99ad-c6ace63b9620"}}]},"url":"https://www.last.fm/music/Madvillain/Madvillainy","name":"Madvillainy","listeners":"1078300"}}
`
const sampleArtistsQuery = `
{"artists":{"artist":[{"tagcount":"0","image":[{"size":"small","#text":"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"medium","#text":"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"large","#text":"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"extralarge","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"mega","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"}],"mbid":"5441c29d-3602-4898-b1a1-b77fa23b8e50","url":"https://www.last.fm/music/David+Bowie","playcount":"1375","name":"David Bowie","streamable":"0"},{"tagcount":"0","image":[{"size":"small","#text":"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"medium","#text":"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"large","#text":"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"extralarge","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"mega","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"}],"mbid":"09037f07-42bc-46ac-a1ee-37f834451fee","url":"https://www.last.fm/music/Minor+Threat","playcount":"1357","name":"Minor Threat","streamable":"0"},{"tagcount":"0","image":[{"size":"small","#text":"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"medium","#text":"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"large","#text":"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"extralarge","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"mega","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"}],"mbid":"3285dc48-9505-469d-ad8a-bdf2d3dba632","url":"https://www.last.fm/music/Swans","playcount":"1315","name":"Swans","streamable":"0"},{"tagcount":"0","image":[{"size":"small","#text":"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"medium","#text":"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"large","#text":"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"extralarge","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"mega","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"}],"mbid":"a506f761-2c22-4b2f-8a94-bd748c2c8f75","url":"https://www.last.fm/music/Neutral+Milk+Hotel","playcount":"1300","name":"Neutral Milk Hotel","streamable":"0"},{"tagcount":"0","image":[{"size":"small","#text":"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"medium","#text":"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"large","#text":"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"extralarge","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"mega","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"}],"mbid":"e520459c-dff4-491d-a6e4-c97be35e0044","url":"https://www.last.fm/music/Frank+Ocean","playcount":"1008","name":"Frank Ocean","streamable":"0"},{"tagcount":"0","image":[{"size":"small","#text":"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"medium","#text":"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"large","#text":"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"extralarge","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"},{"size":"mega","#text":"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png"}],"mbid":"19499124-36d4-4ccc-b28d-04dde3d2076f","url":"https://www.last.fm/music/Jorge+Ben","playcount":"644","name":"Jorge Ben","streamable":"0"}]}}
`

describe('Last.FM API classes abstrations', () => {
  it('abstracts library.getArtists endpoint response', () => {
    const albumData = JSON.parse(sampleAlbumQuery).album
    const album = new Album(albumData)

    // without class abstration: album.name
    expect(album.name).toBe('Madvillainy')
    // without class abstration: album.artist.name
    expect(album.artist).toBe('Madvillain')
    // without class abstration: album.image[album.image.lenght-1][#text]
    expect(album.imgUrl).toBe(
      'https://lastfm.freetls.fastly.net/i/u/300x300/893fce336634c600b2bab31de7bbc9bd.jpg'
    )
    // without class abstration: album.tracks.track[0].name
    expect(album.tracks?.[0].name).toBe('The Illest Villains')
    // without class abstration: album.tracks.track[0][@attr].rank
    expect(album.tracks?.[0].number).toBe(1)
  })

  it('abstracts album.getInfo endpoint response', () => {
    const artistData = JSON.parse(sampleArtistsQuery).artists.artist
    const artists = Artist.array(artistData)
    // without class abstration: artist.name
    expect(artists[2].id).toBe('3285dc48-9505-469d-ad8a-bdf2d3dba632')
    // without class abstration: artist.name
    expect(artists[5].name).toBe('Jorge Ben')
  })
})
